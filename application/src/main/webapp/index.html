<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Master Control Station</title>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<link rel="stylesheet" type="text/css" href="css/styles.css">

</head>
<body>

	<!-- div is container for google maps map  -->
	<div id="map" class="upperUIElement"></div>
	<div id="JSTable" class="lowerUIElement">lower Element goes here

	</div>



	<script>
		var socket;
		function initialize() {
			var MapsUIDTO;

			var host = "ws://localhost:8080/world";
			try {
				socket = new WebSocket(host);
				socket.onopen = function(msg) {
				};
				socket.onmessage = function(msg) {
					alert('Received new data');
					MapsUIDTO = JSON.parse(msg.data);
					setMarkers(map, MapsUIDTO);
				};
				socket.onclose = function(msg) {
				};

			} catch (ex) {
				console.log(ex);
			}

			// some geo-locations for the markers
			var latlng = new google.maps.LatLng(51.2277411, 6.7734556);
			var mapOptions = {
				zoom : 8,
				center : latlng,
				mapTypeId : google.maps.MapTypeId.ROADMAP
			};

			// creates google maps map
			var map = new google.maps.Map(document.getElementById("map"),
					mapOptions);
		}

		// puts colored temperature markers on the map
		function setMarkers(map, MapsUIDTO) {

			// import different marker colors
			// red marker
			var pinColorRed = "FF0000";
			var pinImageRed = new google.maps.MarkerImage(
					"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"
							+ pinColorRed, new google.maps.Size(21, 34),
					new google.maps.Point(0, 0), new google.maps.Point(10, 34));

			// yellow marker
			var pinColorYellow = "FFFF42"
			var pinImageYellow = new google.maps.MarkerImage(
					"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"
							+ pinColorYellow, new google.maps.Size(21, 34),
					new google.maps.Point(0, 0), new google.maps.Point(10, 34));

			// green marker
			var pinColorGreen = "C6EF8C";
			var pinImageGreen = new google.maps.MarkerImage(
					"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"
							+ pinColorGreen, new google.maps.Size(21, 34),
					new google.maps.Point(0, 0), new google.maps.Point(10, 34));

			// import marker shadow
			var pinShadow = new google.maps.MarkerImage(
					"http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
					new google.maps.Size(40, 37), new google.maps.Point(0, 0),
					new google.maps.Point(12, 35));

			// declarated here but used in upcoming for-loop
			var pinImageColor;

			// iterates over the markerArray and creates GoogleMaps markers	
			for ( var j = 0; j < MapsUIDTO.routes.length; j++) {
				for ( var i = 0; i < MapsUIDTO.routes[j].waypoints.length; i++) {

					// controll construct to differentiate between marker colors
					if (MapsUIDTO.routes[j].waypoints[i].status == "critical") {
						pinImageColor = pinImageRed
					} else if (MapsUIDTO.routes[j].waypoints[i].status == "warning") {
						pinImageColor = pinImageYellow
					} else if (MapsUIDTO.routes[j].waypoints[i].status == "Ok") {
						pinImageColor = pinImageGreen
					}

					// actual marker creation
					var marker = new google.maps.Marker({
						position : new google.maps.LatLng(
								MapsUIDTO.routes[j].waypoints[i].x,
								MapsUIDTO.routes[j].waypoints[i].y),
						map : map,
						icon : pinImageColor,
						shadow : pinShadow,
						title : MapsUIDTO.routes[j].waypoints[i].temperature
					});
				}

			}
		}

		// draw coloured routes via polylines
		function drawColoredRoutes(map, markerArray) {

			// created for upcoming fill with LatLng data
			drawnRouteArray = new Array();

			// loop over markerArray and create waypoints for routes to be drawn
			for ( var i = 0; i < markerArray.length; i++) {
				drawnRouteArray[drawnRouteArray.length] = new google.maps.LatLng(
						markerArray[i].lat, markerArray[i].lng);
			}

			// draw actual route
			var routePath = new google.maps.Polyline({
				path : drawnRouteArray,
				strokeColor : "#FF0000",
				strokeOpacity : 1.0,
				strokeWeight : 2
			});

			// put it all on the map object
			routePath.setMap(map);

		}

		// initializes map-creation function
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function() {
					if (oldonload) {
						oldonload();
					}
					func();
				}
			}
		}
		addLoadEvent(initialize);
	</script>

</body>
</html>